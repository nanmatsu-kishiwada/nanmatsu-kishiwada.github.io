<!DOCTYPE html>
<!--
    ‰∏¶ÊùæÁî∫Ëã•È†≠ „Éá„Ç∏„Çø„É´Ëä±Êùø
    Copyright (c) 2025 nanmatsu-kishiwada. All rights reserved.
    
    „Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„Åä„Çà„Å≥„Åù„ÅÆ„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„ÅØËëó‰ΩúÊ®©„Å´„Çà„Çä‰øùË≠∑„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
    ÂïÜÁî®„ÉªÈùûÂïÜÁî®„ÇíÂïè„Çè„Åö„ÄÅ‰∫ãÂâç„ÅÆÊõ∏Èù¢„Å´„Çà„ÇãË®±ÂèØ„Å™„Åó„Å´„ÄÅ
    „Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅÆ‰∏ÄÈÉ®„Åæ„Åü„ÅØÂÖ®ÈÉ®„Çí‰ΩøÁî®„ÄÅË§áË£Ω„ÄÅÊîπÂ§â„ÄÅ
    ÈÖçÂ∏É„Åô„Çã„Åì„Å®„ÇíÁ¶Å„Åò„Åæ„Åô„ÄÇ
    
    This software and its source code are protected by copyright.
    Any use, reproduction, modification, or distribution of this software,
    in whole or in part, for commercial or non-commercial purposes,
    is strictly prohibited without prior written permission.
-->
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏¶ÊùæÁî∫Ëã•È†≠ Âæ°Ëä±Âæ°Ëä≥Âêç(R7)</title>
    
    <!-- Ionic Framework -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core@8.7.3/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core@8.7.3/dist/ionic/ionic.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core@8.7.3/css/ionic.bundle.css" />
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3.5.20/dist/vue.global.js"></script>
    
    <!-- Google Fonts - Yuji Syuku -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&family=Noto+Serif+JP:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Ë®≠ÂÆöÂÆöÊï∞ */
        :root {
            --calligraphy-font: 'Yuji Syuku', 'Noto Serif JP', serif;
            --background-color: #f5f5dc;
            --paper-color: #faf0e6;
            --text-color: #2c1810;
            --red-accent: #cc3333;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .title-default {
            /* ÊØõÁ≠Ü„Éï„Ç©„É≥„Éà */
            font-family: var(--calligraphy-font) !important;
        }
        
        .hanshi-card {
            /* ÊØõÁ≠Ü„Éï„Ç©„É≥„Éà */
            font-family: var(--calligraphy-font) !important;
        }
        
        .search-container {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .search-toggle {
            padding: 0.5rem 1rem;
            cursor: pointer;
            background: #3880ff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .search-content {
            padding: 1rem;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .search-content.collapsed {
            max-height: 0;
            padding: 0 1rem;
        }
        
        .search-content.expanded {
            max-height: 500px;
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .hanaita-container {
            padding: 1rem;
            background-color: var(--background-color);
        }
        
        .hanaita-grid {
            display: flex ;
            flex-flow: row-reverse wrap;
            gap: 1rem;
            margin: 0 auto;
        }
        
        .hanshi-card {
            /*border: 2px solid var(--red-accent);*/
            border-radius: 8px;
            padding: 0.1rem;
            position: relative;
            min-width: 150px;
            aspect-ratio: 3/4;
            /* background-image: 
                radial-gradient(circle at 20% 30%, rgba(204, 51, 51, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(204, 51, 51, 0.1) 0%, transparent 20%),
                linear-gradient(45deg, rgba(204, 51, 51, 0.05) 25%, transparent 25%); */
            background: whitre;
            /* background-image: url("/images/ebi.png"); */
            background-image: url("/images/ebi2.jpg");
            background-size: contain;
            background-repeat: repeat;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            color: var(--text-color);
        }
        
        .hanshi-card[data-clickable="true"] {
            cursor: pointer;
        }
        
        .town-name {
            font-size: 1.3rem;
            margin-bottom: 0.2rem;
            text-align: center;
            font-weight: 700;
        }
        
        .dono {
            font-size: 1.3rem;
            /*margin-bottom: 0.8rem;*/
            text-align: center;
            font-weight: 700;
        }
        
        .name-container {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            margin: auto ;
            writing-mode: vertical-rl;
            flex-direction: column;
            word-break: break-word;
            max-height: 132px;
            max-width: 146px;
            line-height: 1.5rem;
            font-size: 1.4rem;
        }
        
        .hanshi-card[data-clickable="true"] .person-name {
            color: blue;
        }
        
        .position-title {
            font-size: 0.9rem;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: 600;
            margin-right: -1.5rem;
        }
        
        .person-name {
            font-weight: 700;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.15em;
            text-combine-upright: digits 2;
            text-align: start;
            text-align-last: end;
        }
        .text-len-1 {
            font-size: 150%;
            text-align: justify;
        }
        .text-len-2 {
            font-size: 150%;
            text-align: justify;
        }
        .text-len-3 {
            font-size: 130%;
            text-align: justify;
        } 
        .text-len-4 {
            font-size: 120%;
            text-align: justify;
        } 
        .text-len-5 {
            font-size: 105%;
            text-align: justify;
        } 
        .text-len-6 {
            font-size: 85%;
        } 
        .text-len-7 {
            font-size: 80%;
        } 
        .text-len-8 {
            font-size: 80%;
        } 
        .text-len-9 {
            font-size: 75%;
        } 
        .text-len-12 {
            font-size: 75%;
        } 
        .text-len-15 {
            font-size: 70%;
        } 
        .text-len-18 {
            font-size: 70%;
        } 
        .text-len-21 {
            font-size: 65%;
        } 
        .text-len-24 {
            font-size: 65%;
        } 
        .text-len-27 {
            font-size: 65%;
        } 
        .text-len-30 {
            font-size: 60%;
        } 
        .text-len-33 {
            font-size: 60%;
        } 

        .amount {
            position: absolute;
            right: 0.5rem;
            top: 2rem;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.08em;
        }
        
        .link-container {
            position: absolute;
            left: 10px;
            bottom: 10px;
            font-size: 1.2rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
        }
        
        .error {
            text-align: center;
            padding: 2rem;
            color: #cc3333;
            font-size: 1.1rem;
        }
        
        .chevron {
            transition: transform 0.3s ease;
        }
        
        .chevron.rotated {
            transform: rotate(180deg);
        }
        
        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
        }

        /* HACK: Safari „ÅÆ„Åø„Å´ÈÅ©Áî®„Åó„Åü„ÅÑ CSS */
        _::-webkit-full-page-media, _:future, :root .person-name {
            letter-spacing: 0.1em;
            word-spacing: -0.8em;
        }
        @media screen and (-webkit-min-device-pixel-ratio:0) {
            ::i-block-chrome, .person-name {
                letter-spacing: 0.1em;
                word-spacing: -0.8em;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <ion-app>
            <ion-header>
                <ion-toolbar color="primary">
                    <ion-title>‰∏¶ÊùæÁî∫Ëã•È†≠ Âæ°Ëä±Âæ°Ëä≥Âêç(R7)</ion-title>
                </ion-toolbar>
            </ion-header>
            
            <ion-content>
                <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É†Ôºà„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Ôºâ -->
                <div class="search-container">
                    <div class="search-toggle" @click="toggleSearch">
                        <span>üîç Ê§úÁ¥¢„ÉªÁµû„ÇäËæº„Åø</span>
                        <ion-icon name="chevron-down" :class="{ 'chevron': true, 'rotated': searchExpanded }"></ion-icon>
                    </div>
                    <div :class="{ 'search-content': true, 'expanded': searchExpanded, 'collapsed': !searchExpanded }">
                        <div class="search-grid">
                            <ion-item>
                                <ion-label position="stacked">Áî∫Âêç„ÅßÁµû„ÇäËæº„Åø</ion-label>
                                <ion-select :value="searchTown" placeholder="Áî∫Âêç„ÇíÈÅ∏Êäû" ref="searchTownSelect">
                                    <ion-select-option value="">„Åô„Åπ„Å¶Ë°®Á§∫</ion-select-option>
                                    <ion-select-option v-for="town in uniqueTowns" :key="town" :value="town">
                                        {{ town }}
                                    </ion-select-option>
                                </ion-select>
                            </ion-item>
                            <ion-item>
                                <ion-label position="stacked">ÈáëÈ°ç„ÅßÁµû„ÇäËæº„Åø</ion-label>
                                <ion-select :value="searchAmount" placeholder="ÈáëÈ°ç„ÇíÈÅ∏Êäû" ref="searchAmountSelect">
                                    <ion-select-option value="">„Åô„Åπ„Å¶Ë°®Á§∫</ion-select-option>
                                    <ion-select-option v-for="amount in uniqueAmounts" :key="amount" :value="amount">
                                        {{ amount.toLocaleString() }}ÂÜÜ
                                    </ion-select-option>
                                </ion-select>
                            </ion-item>
                        </div>
                        <ion-item>
                            <ion-label position="stacked">„Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢</ion-label>
                            <ion-input :value="searchKeyword" placeholder="ÂêçÂâç„ÇÑÁî∫Âêç„ÅßÊ§úÁ¥¢" ref="searchInput"></ion-input>
                        </ion-item>
                        <div style="margin-top: 0.5rem; text-align: center;">
                            <ion-chip color="primary">
                                <ion-label>Ë°®Á§∫‰ª∂Êï∞: {{ filteredDonors.length }}</ion-label>
                            </ion-chip>
                        </div>
                    </div>
                </div>
                
                <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫ -->
                <div v-if="loading" class="loading">
                    <ion-spinner></ion-spinner>
                    <p>„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
                </div>
                
                <!-- „Ç®„É©„ÉºË°®Á§∫ -->
                <div v-if="error" class="error">
                    <p>{{ error }}</p>
                    <ion-button @click="loadData" color="primary">ÂÜçË™≠„ÅøËæº„Åø</ion-button>
                </div>
                
                <!-- Ëä±ÊùøË°®Á§∫ -->
                <div v-if="!loading && !error" class="hanaita-container">
                    <div class="hanaita-grid">
                        <div v-for="donor in filteredDonors" :key="donor.id" 
                             class="hanshi-card"
                             @click="openUrl(donor.url)"
                             :data-clickable="!!donor.url">
                            <div class="town-name">{{ donor.townName }}</div>
                            <div class="name-container">
                                <div class="amount">{{ donor.amountKanji }}</div>
                                <div v-if="donor.position" class="position-title">{{ donor.position }}</div>
                                <!-- TODO: ‰∫åË°å„Å´ÂàÜ„Åë„Å¶„ÄÅ1Ë°åÁõÆ„Çí‰∏ä„Å´„ÄÅ‰∫åË°åÁõÆ„Çí‰∏ã„Å´„Åó„Åü„ÅÑ -->
                                    <div class="person-name" :class="'text-len-' + cssClassByNameLen(donor.name)">{{ donor.name }}</div>
                            </div>
                            <div class="dono">ÊÆø</div>
                            <div class="link-container" v-if="donor.url">
                                <a :href="donor.url" target="_blank">
                                    <i class="fa-solid fa-up-right-from-square"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </ion-content>
        </ion-app>
    </div>

    <script>
        /*
         * ‰∏¶ÊùæÁî∫Ëã•È†≠ „Éá„Ç∏„Çø„É´Ëä±Êùø
         * Copyright (c) 2025 nanmatsu-kishiwada. All rights reserved.
         * 
         * ÁÑ°Êñ≠Âà©Áî®„ÇíÁ¶Å„Åò„Åæ„Åô„ÄÇÂïÜÁî®„ÉªÈùûÂïÜÁî®„ÇíÂïè„Çè„Åö„ÄÅ‰∫ãÂâç„ÅÆÊõ∏Èù¢„Å´„Çà„ÇãË®±ÂèØ„Å™„Åó„Å´
         * „Åì„ÅÆ„ÇΩ„Éï„Éà„Ç¶„Çß„Ç¢„ÅÆ‰ΩøÁî®„ÄÅË§áË£Ω„ÄÅÊîπÂ§â„ÄÅÈÖçÂ∏É„ÇíË°å„ÅÜ„Åì„Å®„ÅØ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ
         */
        
        // Ë®≠ÂÆöÂÆöÊï∞
        const CONFIG = {
            SPREADSHEET_ID: '1WyNipFGZPQzFfLmJZ2JpS8zZa940w-pUrpqk-5miGxU',
            SHEET_NAME: 'R7Êé≤ËºâÁî®',
            CALLIGRAPHY_FONT: 'Yuji Syuku, Noto Serif JP, serif'
        };
        
        const { createApp } = Vue;
        
        const app = createApp({
            data() {
                return {
                    donors: [],
                    filteredDonors: [],
                    loading: true,
                    error: null,
                    searchTown: '',
                    searchAmount: '',
                    searchKeyword: '',
                    debouncedKeyword: '',
                    debounceTimeout: null,
                    searchExpanded: false
                };
            },
            computed: {
                uniqueTowns() {
                    const towns = [...new Set(this.donors.map(donor => donor.townName))];
                    return towns.sort((a, b) => {
                        const aCategory = this.getAreaCategory(a);
                        const bCategory = this.getAreaCategory(b);
                        if (aCategory !== bCategory) {
                            return aCategory - bCategory;
                        }
                        return a.localeCompare(b);
                    });
                },
                uniqueAmounts() {
                    const amounts = [...new Set(this.donors.map(donor => donor.amount))];
                    return amounts.sort((a, b) => b - a);
                },
            },
            mounted() {
                this.loadData().then(()=>{
                    this.refreshFilteredDonors()
                });

                // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÁõ¥Êé•ÁôªÈå≤
                // TODO: @ionChange „Å™„Å©„ÅÆÊßãÊñá„Åß„ÅØ„ÅÜ„Åæ„ÅèÂãï‰Ωú„Åó„Å™„Åã„Å£„Åü
                this.$refs.searchTownSelect.addEventListener('ionChange', this.onTownChange);
                this.$refs.searchAmountSelect.addEventListener('ionChange', this.onAmountChange);
                this.$refs.searchInput.addEventListener('ionInput', this.onSearchInput);
            },
            watch: {
                searchTown(newValue) {
                    this.refreshFilteredDonors();
                },
                searchAmount(newValue) {
                    this.refreshFilteredDonors();
                },
                debouncedKeyword(newValue) {
                    this.refreshFilteredDonors();
                }
            },
            methods: {
                toggleSearch() {
                    this.searchExpanded = !this.searchExpanded;
                },
                
                openUrl(url) {
                    if (url && url.trim()) {
                        window.open(url, '_blank');
                    }
                },
                
                onTownChange(event) {
                    // TODO: v-model, :value „Åß „ÅÆ„Éê„Ç§„É≥„Éá„Ç£„É≥„Ç∞„ÇÇÂäπ„ÅÑ„Å¶„ÅÑ„Å™„ÅÑ„Çà„ÅÜ„Åß„ÄÅ„Åì„Åì„Åß„Çª„ÉÉ„Éà„Åó„Å¶Âàù„ÇÅ„Å¶ watch „ÅåÁô∫Âãï„Åô„Çã
                    this.searchTown = event.detail.value;
                },
                
                onAmountChange(event) {
                    this.searchAmount = event.detail.value;
                },
                
                onSearchInput(event) {
                    this.searchKeyword = event.detail.value;
                    
                    // „Éá„Éê„Ç¶„É≥„ÇπÂá¶ÁêÜ
                    if (this.debounceTimeout) {
                        clearTimeout(this.debounceTimeout);
                    }
                    
                    this.debounceTimeout = setTimeout(() => {
                        this.debouncedKeyword = this.searchKeyword;
                    }, 300);
                },
                
                async loadData() {
                    this.loading = true;
                    this.error = null;
                    
                    try {
                        const csvUrl = `https://docs.google.com/spreadsheets/d/${CONFIG.SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(CONFIG.SHEET_NAME)}`;
                        
                        const response = await fetch(csvUrl);
                        if (!response.ok) {
                            throw new Error('„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                        }
                        
                        const csvText = await response.text();
                        this.parseCsvData(csvText);
                        
                    } catch (err) {
                        this.error = '„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + err.message;
                        console.error('Error loading data:', err);
                    } finally {
                        this.loading = false;
                    }
                },
                
                parseCsvData(csvText) {
                    const lines = csvText.split('\n');
                    const donors = [];
                    
                    // „Éò„ÉÉ„ÉÄ„ÉºË°å„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Å¶Âá¶ÁêÜ
                    for (let i = 2; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const columns = this.parseCsvLine(line);
                        if (columns.length < 13) continue;
                        
                        // DÂàó:Áî∫Âêç, KÂàó:ÂΩπËÅ∑Âêç, EÂàó:Âæ°Ëä≥Âêç, LÂàó:ÈáëÈ°ç, JÂàó:Ëä±ÊùøÈùûÊé≤Ëºâ, MÂàó:URL, NÂàó:Ëä±ÊùøË°®Á§∫È†Ü
                        const townName = columns[3] || '';
                        const position = columns[10] || '';
                        const name = columns[4]?.replace(/\s+/g, ' ') || '';
                        const amountStr = columns[11] || '';
                        const hideFlag = columns[9] || '';
                        const url = columns[12] || '';
                        const displayOrder = columns[13] || '';
                        
                        // Ëä±Êùø‰∏çÊé≤Ëºâ„Éï„É©„Ç∞„Åå1„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                        if (hideFlag === '1') continue;
                        
                        // ÈáëÈ°ç„ÅÆÂá¶ÁêÜ
                        const amount = this.parseAmount(amountStr);
                        if (!amount || !name.trim()) continue;
                        
                        donors.push({
                            id: i,
                            townName: townName.replace(/"/g, ''),
                            position: position.replace(/"/g, '').trim() || null,
                            name: name.replace(/[Ôºà\(]Ê†™[Ôºâ\)]/g, '„à±'),
                            url,
                            amount,
                            amountKanji: this.convertToKanji(amount),
                            displayOrder: displayOrder ? parseFloat(displayOrder) : null
                        });
                    }
                    
                    // „ÇΩ„Éº„ÉàÂá¶ÁêÜ
                    this.donors = this.sortDonors(donors);
                },
                
                parseCsvLine(line) {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            result.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current);
                    
                    return result;
                },
                
                cssClassByNameLen(name) {
                    return name.length >= 9 ? Math.trunc(name.length/3)*3 : name.length;
                },

                parseAmount(amountStr) {
                    const cleaned = amountStr.replace(/[¬•,]/g, '').replace(/"/g, '');
                    const amount = parseInt(cleaned);
                    return isNaN(amount) ? null : amount;
                },
                
                convertToKanji(amount) {
                    const kanjiMap = {
                        50000: 'Èáë‰ºçËê¨Âúì‰πü',
                        30000: 'ÈáëÂèÉËê¨Âúì‰πü',
                        25000: 'ÈáëÂºêËê¨‰ºçÂçÉÂúì‰πü',
                        20000: 'ÈáëÂºêËê¨Âúì‰πü',
                        15000: 'ÈáëÂ£±Ëê¨‰ºçÂçÉÂúì‰πü',
                        10000: 'ÈáëÂ£±Ëê¨Âúì‰πü',
                        8000: 'ÈáëÂÖ´ÂçÉÂúì‰πü',
                        7000: 'Èáë‰∏ÉÂçÉÂúì‰πü',
                        5000: 'Èáë‰ºçÂçÉÂúì‰πü',
                        3000: 'ÈáëÂèÉÂçÉÂúì‰πü',
                        2000: 'ÈáëÂºêÂçÉÂúì‰πü',
                        1000: 'ÈáëÂçÉÂúì‰πü'
                    };
                    
                    return kanjiMap[amount] || `Èáë${amount.toLocaleString()}Âúì‰πü`;
                },
                
                getAreaCategory(townName) {
                    if (townName === '‰∏¶ÊùæÁî∫') return 0; // ÊúÄÂÑ™ÂÖà
                    if (townName.endsWith('Áî∫')) return 1;
                    if (townName.endsWith('Â∏Ç')) return 2;
                    if (townName.match(/[ÈÉΩÈÅìÂ∫úÁúå]$/)) return 3;
                    return 4; // „Åù„ÅÆ‰ªñ
                },
                
                refreshFilteredDonors() {
                    let filtered = [...this.donors];
                    
                    // Áî∫Âêç„Éï„Ç£„É´„Çø
                    if (this.searchTown) {
                        filtered = filtered.filter(donor => donor.townName === this.searchTown);
                    }
                    
                    // ÈáëÈ°ç„Éï„Ç£„É´„Çø
                    if (this.searchAmount) {
                        filtered = filtered.filter(donor => donor.amount === this.searchAmount);
                    }
                    
                    // „Éï„É™„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢Ôºà„Éá„Éê„Ç¶„É≥„ÇπÊ∏à„ÅøÔºâ
                    if (this.debouncedKeyword) {
                        const keyword = this.debouncedKeyword.toLowerCase();
                        filtered = filtered.filter(donor => 
                            donor.name.toLowerCase().includes(keyword) ||
                            donor.townName.toLowerCase().includes(keyword) ||
                            (donor.position && donor.position.toLowerCase().includes(keyword))
                        );
                    }
                    
                    this.filteredDonors = filtered;
                },

                sortDonors(donors) {
                    return donors.sort((a, b) => {
                        // 1. ÈáëÈ°ç„ÅÆÈ´ò„ÅÑÈ†Ü
                        if (a.amount !== b.amount) {
                            return b.amount - a.amount;
                        }
                        
                        // 2. „Ç®„É™„Ç¢Âå∫ÂàÜ„ÅÆÈ†Ü
                        const aCategory = this.getAreaCategory(a.townName);
                        const bCategory = this.getAreaCategory(b.townName);
                        if (aCategory !== bCategory) {
                            return aCategory - bCategory;
                        }
                        
                        // 3. Ëä±ÊùøË°®Á§∫È†Ü„ÅÆÊåáÂÆöÈ†Ü
                        if (a.displayOrder !== null && b.displayOrder !== null) {
                            if (a.displayOrder !== b.displayOrder) {
                                return a.displayOrder - b.displayOrder;
                            }
                        } else if (a.displayOrder !== null) {
                            return -1;
                        } else if (b.displayOrder !== null) {
                            return 1;
                        }
                        
                        // 4. Áî∫ÂêçÈ†ÜÔºàÊñáÂ≠ó„Ç≥„Éº„ÉâÈ†ÜÔºâ
                        return a.townName.localeCompare(b.townName);
                    });
                }
            }
        });

        app.config.compilerOptions.isCustomElement = (tag) => tag.includes('-')
        app.mount('#app')
    </script>
</body>
</html>
